<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hub de Sistemas</title>

  <!-- ====== CONFIG: COLE AQUI SEU SUPABASE URL + ANON KEY ====== -->
  <script>
    // üëâ pegue no Supabase: Project Settings ‚Üí API
    window.SUPABASE_URL = "COLE_AQUI_SUA_SUPABASE_URL";
    window.SUPABASE_ANON_KEY = "COLE_AQUI_SUA_SUPABASE_ANON_KEY";
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg0:#070812;
      --bg1:#0b0d18;
      --cardA: rgba(255,255,255,.06);
      --cardB: rgba(255,255,255,.03);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --text:#e9e9f1;
      --muted: rgba(233,233,241,.72);
      --muted2: rgba(233,233,241,.55);

      --teal:#25d0c2;
      --green:#22c55e;
      --yellow:#f59e0b;
      --red:#ef4444;
      --blue:#0ea5e9;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(37,208,194,.12), transparent 60%),
        radial-gradient(900px 500px at 85% 0%, rgba(14,165,233,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
    }

    /* Topbar */
    .topbar{
      height:56px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
      position: sticky;
      top:0;
      z-index: 20;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .brand .dot{
      width:28px; height:28px; border-radius:10px;
      background: linear-gradient(135deg, rgba(37,208,194,.18), rgba(14,165,233,.14));
      border: 1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:center;
    }
    .brand span b{ color: var(--teal); }

    .right{
      display:flex; align-items:center; gap:10px;
    }

    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:600;
      font-size: 13px;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: var(--stroke2); }
    .btn.primary{ border-color: rgba(14,165,233,.35); background: rgba(14,165,233,.14); }
    .btn.danger{ border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.14); }
    .btn.ghost{ background: transparent; }

    .wrap{
      max-width: 1200px;
      margin: 18px auto 60px;
      padding: 0 14px;
    }

    .header{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap: 12px;
      margin: 18px 0 14px;
    }
    .header h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .header p{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
    }

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 14px;
    }

    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Card */
    .card{
      position: relative;
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, var(--cardA), var(--cardB));
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      overflow:hidden;
      min-height: 120px;
    }
    .card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(900px 180px at 20% 0%, rgba(37,208,194,.10), transparent 60%);
      pointer-events:none;
    }

    .row{
      display:flex;
      gap: 12px;
      align-items: center;
    }

    .iconbox{
      width: 46px; height:46px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 22px;
      flex: 0 0 auto;
      overflow:hidden;
    }
    .iconbox img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .info{
      flex: 1 1 auto;
      min-width: 0;
    }
    .title{
      display:flex; align-items:center; gap: 10px;
    }
    .title h3{
      margin:0;
      font-size: 16px;
      letter-spacing:.2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .subtitle{
      margin-top: 4px;
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .status{
      flex: 0 0 auto;
      border-radius: 12px;
      padding: 7px 10px;
      font-weight: 800;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      display:flex; align-items:center; gap: 8px;
    }
    .pill{
      width: 9px; height:9px; border-radius:999px;
      background: var(--red);
      box-shadow: 0 0 0 3px rgba(239,68,68,.15);
    }
    .online .pill{ background: var(--green); box-shadow: 0 0 0 3px rgba(34,197,94,.14); }
    .warning .pill{ background: var(--yellow); box-shadow: 0 0 0 3px rgba(245,158,11,.14); }

    .actions{
      margin-top: 12px;
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .action-btn{
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:700;
      font-size: 12.5px;
    }
    .action-btn:hover{ background: rgba(255,255,255,.10); }
    .action-btn.secondary{ opacity: .92; }
    .action-btn.ghost{ background: transparent; }

    /* Edit controls */
    .editbar{
      display:none;
      gap: 8px;
      margin-top: 12px;
      border-top: 1px dashed rgba(255,255,255,.10);
      padding-top: 12px;
    }
    .edit-on .editbar{ display:flex; }

    .mini{
      font-size: 12px;
      padding: 7px 9px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
    }
    .mini:focus{ border-color: rgba(14,165,233,.35); }

    .editable{
      outline: none;
      border-radius: 10px;
      padding: 2px 6px;
      margin-left: -6px;
    }
    .edit-on .editable[contenteditable="true"]:focus{
      background: rgba(14,165,233,.12);
      border: 1px solid rgba(14,165,233,.25);
    }

    /* Toast */
    .toast{
      position: fixed;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.12);
      padding: 10px 12px;
      border-radius: 14px;
      display:none;
      z-index: 99999;
      backdrop-filter: blur(10px);
      max-width: min(700px, calc(100vw - 24px));
      color: var(--text);
      font-size: 13px;
    }
    .toast.show{ display:block; }

    /* Modal */
    .modal { position: fixed; inset: 0; display:none; z-index: 9999; }
    .modal[aria-hidden="false"]{ display:block; }
    .modal-backdrop{
      position:absolute; inset:0;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(6px);
    }
    .modal-card{
      position: relative;
      width: min(1200px, calc(100vw - 40px));
      height: min(760px, calc(100vh - 40px));
      margin: 20px auto;
      border-radius: 16px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(25,25,35,.96), rgba(15,15,25,.96));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
    }
    .modal-topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
    }
    .modal-title{ display:flex; flex-direction:column; gap:2px; }
    #modalTitle{ font-weight: 800; font-size: 14px; letter-spacing:.2px; }
    .modal-url{ font-size: 12px; opacity:.75; max-width: 820px; overflow:hidden; text-overflow: ellipsis; white-space: nowrap; }
    .modal-actions{ display:flex; gap:8px; }
    .modal-body{ width:100%; height: calc(100% - 56px); }
    #modalFrame{ width:100%; height:100%; border:0; background:#0b0b12; }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <div class="dot">‚¨°</div>
      <span>HUB <b>SISTEMAS</b></span>
    </div>

    <div class="right">
      <button id="btnEdit" class="btn primary">üõ†Ô∏è Editar</button>
      <button id="btnAdd" class="btn">‚ûï Novo Sistema</button>
      <button id="btnReloadHub" class="btn ghost">‚Üª Recarregar</button>
    </div>
  </div>

  <div class="wrap">
    <div class="header">
      <div>
        <h1>Hub de Sistemas</h1>
        <p>Clique em um bot√£o para abrir a aplica√ß√£o em um modal. Ative ‚ÄúEditar‚Äù para personalizar tudo.</p>
      </div>
    </div>

    <div id="grid" class="grid"></div>
  </div>

  <div id="toast" class="toast"></div>

  <!-- MODAL VIEWER -->
  <div id="appModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop" data-close="1"></div>

    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Aplica√ß√£o">
      <div class="modal-topbar">
        <div class="modal-title">
          <span id="modalTitle">Aplica√ß√£o</span>
          <span id="modalUrl" class="modal-url"></span>
        </div>

        <div class="modal-actions">
          <button id="btnOpenNew" class="btn ghost">Abrir em nova aba</button>
          <button id="btnReload" class="btn ghost">Recarregar</button>
          <button id="btnClose" class="btn danger">Fechar</button>
        </div>
      </div>

      <div class="modal-body">
        <iframe
          id="modalFrame"
          title="Aplica√ß√£o"
          referrerpolicy="no-referrer"
          allow="clipboard-read; clipboard-write; fullscreen; camera; microphone"
          sandbox="allow-forms allow-modals allow-popups allow-scripts allow-same-origin allow-downloads"
        ></iframe>
      </div>
    </div>
  </div>

  <script>
    // ====== SUPABASE INIT ======
    const { createClient } = window.supabase;
    const supabase = createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);

    // ====== UI STATE ======
    let editMode = false;
    let systems = [];
    let actions = [];

    // ====== ELEMENTS ======
    const grid = document.getElementById("grid");
    const toast = document.getElementById("toast");
    const btnEdit = document.getElementById("btnEdit");
    const btnAdd = document.getElementById("btnAdd");
    const btnReloadHub = document.getElementById("btnReloadHub");

    // Modal
    const appModal   = document.getElementById("appModal");
    const modalFrame = document.getElementById("modalFrame");
    const modalTitle = document.getElementById("modalTitle");
    const modalUrl   = document.getElementById("modalUrl");
    const btnClose   = document.getElementById("btnClose");
    const btnReload  = document.getElementById("btnReload");
    const btnOpenNew = document.getElementById("btnOpenNew");
    let currentUrl = "";

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 2600);
    }

    function openAppModal({ title, url }) {
      currentUrl = url || "";
      modalTitle.textContent = title || "Aplica√ß√£o";
      modalUrl.textContent = url || "";
      modalFrame.src = url || "about:blank";
      appModal.setAttribute("aria-hidden", "false");
    }
    function closeAppModal() {
      appModal.setAttribute("aria-hidden", "true");
      modalFrame.src = "about:blank";
      currentUrl = "";
    }
    btnClose.addEventListener("click", closeAppModal);
    btnReload.addEventListener("click", () => {
      try{
        if (modalFrame.contentWindow) modalFrame.contentWindow.location.reload();
        else modalFrame.src = currentUrl;
      }catch(e){
        // alguns iframes bloqueiam acesso ao contentWindow
        modalFrame.src = currentUrl;
      }
    });
    btnOpenNew.addEventListener("click", () => currentUrl && window.open(currentUrl, "_blank"));
    appModal.addEventListener("click", (e) => { if (e.target?.dataset?.close === "1") closeAppModal(); });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && appModal.getAttribute("aria-hidden") === "false") closeAppModal();
    });

    // ====== DB HELPERS ======
    async function fetchAll(){
      const { data: s, error: e1 } = await supabase
        .from("hub_systems")
        .select("*")
        .order("position", { ascending: true })
        .order("created_at", { ascending: true });

      if (e1) throw e1;

      const { data: a, error: e2 } = await supabase
        .from("hub_actions")
        .select("*")
        .order("position", { ascending: true })
        .order("created_at", { ascending: true });

      if (e2) throw e2;

      systems = s || [];
      actions = a || [];
    }

    async function updateSystem(id, patch){
      const { error } = await supabase.from("hub_systems").update(patch).eq("id", id);
      if (error) throw error;
    }
    async function insertSystem(row){
      const { data, error } = await supabase.from("hub_systems").insert(row).select("*").single();
      if (error) throw error;
      return data;
    }
    async function deleteSystem(id){
      const { error } = await supabase.from("hub_systems").delete().eq("id", id);
      if (error) throw error;
    }

    async function insertAction(row){
      const { data, error } = await supabase.from("hub_actions").insert(row).select("*").single();
      if (error) throw error;
      return data;
    }
    async function updateAction(id, patch){
      const { error } = await supabase.from("hub_actions").update(patch).eq("id", id);
      if (error) throw error;
    }
    async function deleteAction(id){
      const { error } = await supabase.from("hub_actions").delete().eq("id", id);
      if (error) throw error;
    }

    // ====== RENDER ======
    function statusClass(s){
      if (s === "online") return "online";
      if (s === "warning") return "warning";
      return "offline";
    }

    function render(){
      grid.innerHTML = "";

      systems.forEach(sys => {
        const sysActions = actions.filter(a => a.system_id === sys.id);

        const card = document.createElement("div");
        card.className = "card" + (editMode ? " edit-on" : "");
        card.dataset.id = sys.id;

        const iconHtml = (sys.icon_type === "image" && sys.icon_value)
          ? `<img src="${sys.icon_value}" alt="">`
          : (sys.icon_value || "üß©");

        card.innerHTML = `
          <div class="row">
            <div class="iconbox">
              <div class="editable" data-field="icon_value" contenteditable="${editMode}">${iconHtml}</div>
            </div>

            <div class="info">
              <div class="title">
                <h3 class="editable" data-field="title" contenteditable="${editMode}">${escapeHtml(sys.title || "")}</h3>
              </div>
              <div class="subtitle editable" data-field="subtitle" contenteditable="${editMode}">
                ${escapeHtml(sys.subtitle || "Clique em Editar para personalizar")}
              </div>
            </div>

            <div class="status ${statusClass(sys.status)}">
              <span class="pill"></span>
              <span>${(sys.status || "offline").toUpperCase()}</span>
            </div>
          </div>

          <div class="actions">
            ${sysActions.map(a => `
              <button class="action-btn ${a.style || "primary"}"
                data-action="open"
                data-action-id="${a.id}"
                data-title="${escapeAttr((sys.title || "App") + " ‚Ä¢ " + (a.label || "Abrir"))}"
                data-url="${escapeAttr(a.action_value || "")}">
                ${escapeHtml(a.label || "Abrir")}
              </button>
            `).join("")}
          </div>

          <div class="editbar">
            <select class="mini" data-edit="status">
              <option value="online" ${sys.status==="online" ? "selected":""}>online</option>
              <option value="warning" ${sys.status==="warning" ? "selected":""}>warning</option>
              <option value="offline" ${(!sys.status || sys.status==="offline") ? "selected":""}>offline</option>
            </select>

            <select class="mini" data-edit="icon_type">
              <option value="emoji" ${(!sys.icon_type || sys.icon_type==="emoji") ? "selected":""}>√≠cone emoji</option>
              <option value="image" ${sys.icon_type==="image" ? "selected":""}>√≠cone imagem(URL)</option>
            </select>

            <input class="mini" data-edit="icon_url" placeholder="URL da imagem (se √≠cone imagem)" value="${sys.icon_type==="image" ? (sys.icon_value||"") : ""}" style="min-width:260px" />

            <button class="btn" data-editbtn="addAction">‚ûï Bot√£o</button>
            <button class="btn danger" data-editbtn="deleteSystem">üóëÔ∏è Apagar</button>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // ====== SANITIZE HELPERS ======
    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(s){ return escapeHtml(s).replaceAll("\n"," "); }

    function getPlainTextFromEditable(el){
      // Se for √≠cone emoji, o innerText √© ok
      // Se for imagem, o usu√°rio cola URL no input de URL (n√£o aqui)
      return (el.innerText || "").trim();
    }

    // ====== EVENTS ======
    btnEdit.addEventListener("click", async () => {
      editMode = !editMode;
      btnEdit.textContent = editMode ? "‚úÖ Finalizar" : "üõ†Ô∏è Editar";
      showToast(editMode ? "Modo edi√ß√£o ATIVO" : "Modo edi√ß√£o DESATIVADO");
      render();
    });

    btnReloadHub.addEventListener("click", async () => {
      try{
        await fetchAll();
        render();
        showToast("Hub recarregado");
      }catch(e){
        console.error(e);
        alert("Erro ao recarregar: " + (e?.message || e));
      }
    });

    btnAdd.addEventListener("click", async () => {
      try{
        const pos = (systems.reduce((m,s)=>Math.max(m, s.position||0), 0) || 0) + 1;
        const sys = await insertSystem({
          title: "Novo Sistema",
          subtitle: "Edite aqui dentro",
          icon_type: "emoji",
          icon_value: "üß©",
          status: "offline",
          position: pos
        });
        systems.push(sys);

        const act = await insertAction({
          system_id: sys.id,
          label: "Abrir",
          action_type: "modal",
          action_value: "https://example.com",
          style: "primary",
          position: 1
        });
        actions.push(act);

        render();
        showToast("Sistema criado (edite o t√≠tulo, √≠cone e URL)");
      }catch(e){
        console.error(e);
        alert("Erro ao criar: " + (e?.message || e));
      }
    });

    // Clique em bot√µes (abrir app / editar)
    document.addEventListener("click", async (e) => {
      const openBtn = e.target.closest("[data-action='open']");
      if (openBtn){
        const url = openBtn.dataset.url || "";
        const title = openBtn.dataset.title || "Aplica√ß√£o";
        if (!url){
          showToast("Esse bot√£o est√° sem URL (edite no modo edi√ß√£o)");
          return;
        }
        openAppModal({ title, url });
        return;
      }

      // Edit buttons
      const editBtn = e.target.closest("[data-editbtn]");
      if (editBtn){
        const card = e.target.closest(".card");
        const sysId = card?.dataset?.id;
        const action = editBtn.dataset.editbtn;

        if (!sysId) return;

        if (action === "deleteSystem"){
          if (!confirm("Apagar este sistema e seus bot√µes?")) return;
          try{
            await deleteSystem(sysId);
            systems = systems.filter(s => s.id !== sysId);
            actions = actions.filter(a => a.system_id !== sysId);
            render();
            showToast("Sistema apagado");
          }catch(err){
            console.error(err);
            alert("Erro ao apagar: " + (err?.message || err));
          }
        }

        if (action === "addAction"){
          const label = prompt("Nome do bot√£o (ex: Abrir Relat√≥rio):", "Abrir");
          if (!label) return;
          const url = prompt("Cole a URL do site/app que vai abrir no modal:", "https://");
          if (!url) return;

          try{
            const pos = (actions.filter(a=>a.system_id===sysId).reduce((m,a)=>Math.max(m,a.position||0), 0) || 0) + 1;
            const act = await insertAction({
              system_id: sysId,
              label,
              action_type: "modal",
              action_value: url,
              style: "secondary",
              position: pos
            });
            actions.push(act);
            render();
            showToast("Bot√£o criado");
          }catch(err){
            console.error(err);
            alert("Erro ao criar bot√£o: " + (err?.message || err));
          }
        }
        return;
      }
    });

    // Editar texto (blur salva no Supabase)
    document.addEventListener("focusout", async (e) => {
      if (!editMode) return;

      const el = e.target.closest(".editable");
      if (!el) return;

      const card = el.closest(".card");
      const sysId = card?.dataset?.id;
      if (!sysId) return;

      const field = el.dataset.field;
      if (!field) return;

      // √≠cone: quando for emoji, pega texto
      // se o cara tiver colado imagem/HTML, vamos tratar como emoji por texto (innerText)
      const value = getPlainTextFromEditable(el);

      try{
        // Se estiver editando √≠cone e icon_type for image, o valor vem do input URL, n√£o daqui
        if (field === "icon_value"){
          const sys = systems.find(s=>s.id===sysId);
          if (sys?.icon_type === "image"){
            // n√£o salva daqui
            return;
          }
        }

        await updateSystem(sysId, { [field]: value });
        const sys = systems.find(s=>s.id===sysId);
        if (sys) sys[field] = value;

        showToast("Salvo ‚úÖ");
        render(); // re-render pra manter status/ellipsis bonitos
      }catch(err){
        console.error(err);
        alert("Erro ao salvar: " + (err?.message || err));
      }
    });

    // Selects/Inputs da editbar
    document.addEventListener("change", async (e) => {
      if (!editMode) return;

      const card = e.target.closest(".card");
      const sysId = card?.dataset?.id;
      if (!sysId) return;

      const sel = e.target;

      // status
      if (sel.matches("[data-edit='status']")){
        try{
          await updateSystem(sysId, { status: sel.value });
          const sys = systems.find(s=>s.id===sysId);
          if (sys) sys.status = sel.value;
          render();
          showToast("Status atualizado");
        }catch(err){
          console.error(err);
          alert("Erro ao atualizar status: " + (err?.message || err));
        }
      }

      // icon_type
      if (sel.matches("[data-edit='icon_type']")){
        try{
          await updateSystem(sysId, { icon_type: sel.value });
          const sys = systems.find(s=>s.id===sysId);
          if (sys) sys.icon_type = sel.value;

          // se mudou pra emoji e estava image, mant√©m um emoji padr√£o
          if (sel.value === "emoji"){
            await updateSystem(sysId, { icon_value: "üß©" });
            if (sys) sys.icon_value = "üß©";
          }
          render();
          showToast("Tipo de √≠cone atualizado");
        }catch(err){
          console.error(err);
          alert("Erro ao atualizar tipo de √≠cone: " + (err?.message || err));
        }
      }

      // icon_url input (quando icon_type=image)
      if (sel.matches("[data-edit='icon_url']")){
        const url = sel.value.trim();
        const sys = systems.find(s=>s.id===sysId);
        if (!sys || sys.icon_type !== "image") return;

        try{
          await updateSystem(sysId, { icon_value: url });
          sys.icon_value = url;
          render();
          showToast("√çcone (URL) atualizado");
        }catch(err){
          console.error(err);
          alert("Erro ao salvar URL do √≠cone: " + (err?.message || err));
        }
      }
    });

    // ====== START ======
    async function start(){
      try{
        if (!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY || window.SUPABASE_URL.includes("COLE_AQUI")){
          alert("Voc√™ precisa colar SUPABASE_URL e SUPABASE_ANON_KEY no topo do index.html");
          return;
        }
        await fetchAll();

        // se estiver vazio, cria 1 padr√£o
        if (systems.length === 0){
          const sys = await insertSystem({
            title: "Supabase",
            subtitle: "Banco de Dados SQL",
            icon_type: "emoji",
            icon_value: "üü©",
            status: "online",
            position: 1
          });
          systems.push(sys);

          const act = await insertAction({
            system_id: sys.id,
            label: "Abrir",
            action_type: "modal",
            action_value: "https://supabase.com/dashboard",
            style: "primary",
            position: 1
          });
          actions.push(act);
        }

        render();
        showToast("Hub carregado ‚úÖ");
      }catch(e){
        console.error(e);
        alert("Erro ao iniciar: " + (e?.message || e));
      }
    }
    start();
  </script>
</body>
</html>
